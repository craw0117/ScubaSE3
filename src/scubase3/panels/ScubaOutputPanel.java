package scubase3.panels;

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.StandardCopyOption;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JLabel;
import scubase3.Const;
import scubase3.ScubaSE3;

/**
 * ScubaOutputPanel is the upper-right panel in the user interface
 *
 * @author liu1028, eden0021, mitc0341, craw0117, kris0068
 */
public class ScubaOutputPanel extends javax.swing.JPanel {

    /**
     * Default constructor for ScubaOutputPanel
     */
    public ScubaOutputPanel() {
        initComponents();
        
        try
        {
        //Read for package and make a temp file on the file system
        InputStream in = getClass().getResourceAsStream("ScubaTank.png");
        File temp = File.createTempFile("ScubaTank", ".png");
        Files.copy(in, temp.toPath(), StandardCopyOption.REPLACE_EXISTING);
                
        BufferedImage myPicture;
        
        myPicture = ImageIO.read(temp);
        JLabel picLabel = new JLabel(new ImageIcon(myPicture));
        prettyPicture.add(picLabel);
         
        } catch (IOException ex) {
            Logger.getLogger(ScubaOutputPanel.class.getName()).log(Level.SEVERE, null, ex);
        } catch (Exception e) {
            e.printStackTrace();
        }
        
       
    }
    
    /**
     * Updates dynamic components - must be called after state change.
     */
    public void update() {
        
        String outputValue = ScubaSE3.getController().getOutputValue();
        if (outputValue != null) {
            String calculationType = ScubaSE3.getController().getCalculationType();
            String outputOxygen = ScubaSE3.getController().getOutputOxygen();
            String outputUnit = ScubaSE3.getController().getOutputUnit();
            if (Const.UNSAFE_OUTPUT_VALUE.equals(outputValue)) {
                outputText.setText(Const.UNSAFE_OUTPUT_MESSAGE);
            } else if (Const.TYPE_BM.equals(calculationType)) {
                outputText.setText(calculationType + ": " + outputValue + outputUnit);
            } else {
                outputText.setText(calculationType + ": " + outputValue + outputUnit + ", Oxygen: " + outputOxygen + Const.UNIT_PERCENT);
            }
            if (!Const.UNSAFE_OUTPUT_VALUE.equals(outputOxygen) && !outputOxygenDisplay.getValueIsAdjusting()) {
                outputOxygenDisplay.setValue(Integer.valueOf(outputOxygen));
            }
            outputOxygenDisplay.setEnabled((ScubaSE3.getController().getInputFlags() & Const.FLAG_O2_FRACTION) == Const.FLAG_O2_FRACTION);
        } else {
            outputText.setText(Const.UNSAFE_OUTPUT_MESSAGE);
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        outputLHS = new javax.swing.JPanel();
        controls = new javax.swing.JPanel();
        outputOxygenDisplay = new javax.swing.JSlider();
        outputOxygenLabel = new javax.swing.JLabel();
        pictureContainer = new javax.swing.JPanel();
        prettyPicture = new javax.swing.JPanel();
        outputRHS = new javax.swing.JPanel();
        outputText = new javax.swing.JLabel();

        setMinimumSize(new java.awt.Dimension(400, 400));
        setPreferredSize(new java.awt.Dimension(400, 400));
        setLayout(new java.awt.GridBagLayout());

        outputLHS.setAlignmentY(0.5F);
        outputLHS.setPreferredSize(new java.awt.Dimension(200, 345));
        outputLHS.setLayout(new javax.swing.OverlayLayout(outputLHS));

        controls.setOpaque(false);
        controls.setLayout(new java.awt.GridBagLayout());

        outputOxygenDisplay.setMaximum(50);
        outputOxygenDisplay.setMinimum(22);
        outputOxygenDisplay.setOrientation(javax.swing.JSlider.VERTICAL);
        outputOxygenDisplay.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                outputOxygenDisplayStateChanged(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.insets = new java.awt.Insets(0, 15, 0, 15);
        controls.add(outputOxygenDisplay, gridBagConstraints);

        outputOxygenLabel.setText("O2%");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.insets = new java.awt.Insets(10, 0, 0, 0);
        controls.add(outputOxygenLabel, gridBagConstraints);

        outputLHS.add(controls);

        pictureContainer.setLayout(new java.awt.GridBagLayout());

        prettyPicture.setMaximumSize(new java.awt.Dimension(100, 250));
        prettyPicture.setMinimumSize(new java.awt.Dimension(100, 250));
        prettyPicture.setPreferredSize(new java.awt.Dimension(100, 250));
        prettyPicture.setRequestFocusEnabled(false);
        prettyPicture.setVerifyInputWhenFocusTarget(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.insets = new java.awt.Insets(20, 0, 75, 0);
        pictureContainer.add(prettyPicture, gridBagConstraints);

        outputLHS.add(pictureContainer);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        add(outputLHS, gridBagConstraints);

        outputRHS.setMinimumSize(new java.awt.Dimension(100, 400));
        outputRHS.setLayout(new java.awt.GridBagLayout());

        outputText.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        outputText.setText("[This is the output area]");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        outputRHS.add(outputText, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        add(outputRHS, gridBagConstraints);
    }// </editor-fold>//GEN-END:initComponents

    private void outputOxygenDisplayStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_outputOxygenDisplayStateChanged
        ScubaSE3.getController().setOxygenFraction((double) ((javax.swing.JSlider) evt.getSource()).getValue() / 100.0);
    }//GEN-LAST:event_outputOxygenDisplayStateChanged

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel controls;
    private javax.swing.JPanel outputLHS;
    private javax.swing.JSlider outputOxygenDisplay;
    private javax.swing.JLabel outputOxygenLabel;
    private javax.swing.JPanel outputRHS;
    private javax.swing.JLabel outputText;
    private javax.swing.JPanel pictureContainer;
    private javax.swing.JPanel prettyPicture;
    // End of variables declaration//GEN-END:variables
}
